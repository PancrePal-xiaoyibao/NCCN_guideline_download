# æ–‡ä»¶åç”Ÿæˆä¿®å¤æ€»ç»“

## ğŸ¯ é—®é¢˜æè¿°

**åŸå§‹é—®é¢˜**ï¼š
- æ–‡ä»¶åæ€»æ˜¯ç”Ÿæˆ `NCCN_Guideline_version_2_2025.pdf`
- æ²¡æœ‰ä½¿ç”¨åŸå§‹PDFæ–‡ä»¶å
- ç”¨æˆ·æœŸæœ›ï¼š`cll.pdf` ä¿å­˜ä¸º `cll_version_1_2026.pdf`

## âœ… ä¿®å¤æ–¹æ¡ˆ

### æ ¸å¿ƒä¿®æ”¹

1. **å¢å¼º `_enhance_pdf_info()` æ–¹æ³•**
   - æ·»åŠ  `pdf_url` å‚æ•°
   - ä¼˜å…ˆä»URLæå–åŸå§‹æ–‡ä»¶å
   - ä¿ç•™åŸæœ‰çš„æ ‡é¢˜æ¸…ç†é€»è¾‘ä½œä¸ºå¤‡ç”¨

2. **URLè§£æé€»è¾‘**
   ```python
   from urllib.parse import urlparse
   parsed_url = urlparse(pdf_url)
   path = parsed_url.path
   filename = os.path.basename(path)
   filename_prefix = os.path.splitext(filename)[0]
   ```

3. **æ›´æ–°è°ƒç”¨ç‚¹**
   - `_extract_pdfs_from_list()` æ–¹æ³•ä¼ é€’PDF URL
   - `_get_pdfs_from_detail_page_fallback()` æ–¹æ³•ä¼ é€’PDF URL

### ä¿®å¤å‰åå¯¹æ¯”

| åœºæ™¯ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| cll.pdf + Version 1.2026 | NCCN_Guideline_version_1_2026.pdf | **cll_version_1_2026.pdf** |
| AML-2026.pdf + Version 2.2025 | NCCN_Guideline_version_2_2025.pdf | **AML-2026_version_2_2025.pdf** |
| aml.pdf + Version 3.2025 | NCCN_Guideline_version_3_2025.pdf | **aml_version_3_2025.pdf** |
| nsclc.pdf (æ— ç‰ˆæœ¬) | NCCN_Guideline.pdf | **nsclc.pdf** |

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•è„šæœ¬
`test_filename_enhancement.py` - éªŒè¯ä¿®å¤åçš„æ–‡ä»¶åç”Ÿæˆé€»è¾‘

### æµ‹è¯•ç»“æœ
```
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
âœ… ä¿®å¤åçš„æ–‡ä»¶åç”Ÿæˆé€»è¾‘å·¥ä½œæ­£å¸¸
âœ… èƒ½å¤Ÿæ­£ç¡®ä»PDF URLæå–åŸå§‹æ–‡ä»¶å
âœ… æ­£ç¡®ç»“åˆç‰ˆæœ¬ä¿¡æ¯ç”Ÿæˆå¢å¼ºæ–‡ä»¶å
```

### å…·ä½“æµ‹è¯•ç”¨ä¾‹

1. **âœ… cll.pdfæµ‹è¯•**
   - è¾“å…¥: `https://www.nccn.org/professionals/physician_gls/pdf/cll.pdf`
   - è¾“å‡º: `cll_version_1_2026.pdf`
   - çŠ¶æ€: å®Œå…¨ç¬¦åˆè¦æ±‚

2. **âœ… AML-2026.pdfæµ‹è¯•**
   - è¾“å…¥: `https://www.nccn.org/files/content/guidelinespdf/materials/2026/AML-2026.pdf`
   - è¾“å‡º: `AML-2026_version_2_2025.pdf`
   - çŠ¶æ€: æ­£ç¡®æå–å¤æ‚æ–‡ä»¶å

3. **âœ… aml.pdfæµ‹è¯•**
   - è¾“å…¥: `https://www.nccn.org/professionals/physician_gls/pdf/aml.pdf`
   - è¾“å‡º: `aml_version_3_2025.pdf`
   - çŠ¶æ€: å°å†™æ–‡ä»¶åå¤„ç†æ­£ç¡®

4. **âœ… nsclc.pdfæµ‹è¯•ï¼ˆæ— ç‰ˆæœ¬ï¼‰**
   - è¾“å…¥: `https://www.nccn.org/professionals/physician_gls/pdf/nsclc.pdf`
   - è¾“å‡º: `nsclc.pdf`
   - çŠ¶æ€: æ— ç‰ˆæœ¬ä¿¡æ¯æ—¶æ­£ç¡®å¤„ç†

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### URLè§£æé€»è¾‘

```python
def _enhance_pdf_info(self, title: str, version_info: str, pdf_url: str = None):
    # ä¼˜å…ˆä»PDF URLä¸­æå–æ–‡ä»¶å
    if pdf_url:
        from urllib.parse import urlparse
        parsed_url = urlparse(pdf_url)
        path = parsed_url.path
        filename = os.path.basename(path)
        if filename and '.' in filename:
            filename_prefix = os.path.splitext(filename)[0]
            filename_prefix = re.sub(r'[^\w\-_]', '_', filename_prefix)
```

### æ–‡ä»¶åç”Ÿæˆé€»è¾‘

```python
# ç”Ÿæˆå¢å¼ºæ–‡ä»¶å
if version_info != "unknown":
    enhanced_filename = f"{filename_prefix}_version_{version_info}.pdf"
    enhanced_title = f"{clean_title} (Version {version_info.replace('_', '.')})"
else:
    enhanced_filename = f"{filename_prefix}.pdf"
    enhanced_title = clean_title
```

### è°ƒç”¨ç‚¹æ›´æ–°

```python
# åœ¨ _extract_pdfs_from_list() ä¸­
enhanced_info = self._enhance_pdf_info(title, version_info, pdf_url)

# åœ¨ _get_pdfs_from_detail_page_fallback() ä¸­
enhanced_info = self._enhance_pdf_info(title, version_info, pdf_url)
```

## ğŸ¯ å®ç°æ•ˆæœ

### ç”¨æˆ·ä½“éªŒæ”¹è¿›

1. **ä¿æŒåŸå§‹å‘½å**ï¼šä½¿ç”¨PDFæ–‡ä»¶çš„åŸå§‹åç§°
2. **ç‰ˆæœ¬ä¿¡æ¯å¢å¼º**ï¼šæ¸…æ™°æ ‡è¯†ç‰ˆæœ¬ä¿¡æ¯
3. **æ–‡ä»¶è¯†åˆ«å‹å¥½**ï¼šæ–‡ä»¶åæ›´å…·æè¿°æ€§

### å®é™…åº”ç”¨ç¤ºä¾‹

- **CLLæŒ‡å—**ï¼š`cll_version_1_2026.pdf`
- **AMLæŒ‡å—**ï¼š`AML-2026_version_2_2025.pdf`
- **NSCLCæŒ‡å—**ï¼š`nsclc.pdf`ï¼ˆæ— ç‰ˆæœ¬ä¿¡æ¯æ—¶ï¼‰

## ğŸš€ ä½¿ç”¨è¯´æ˜

### å¯åŠ¨ç¨‹åº
```bash
python download_NCCN_Guide_v2_menu.py
```

### é€‰æ‹©é€‰é¡¹1
```
1. ç™Œç—‡æ²»ç–—æŒ‡å—è‹±æ–‡ç‰ˆ (Treatment by Cancer Type - English Only)
```

### éªŒè¯æ–‡ä»¶å
ä¸‹è½½çš„æ–‡ä»¶å°†ä½¿ç”¨æ–°çš„å‘½åæ ¼å¼ï¼š
- æ ¼å¼ï¼š`[åŸå§‹æ–‡ä»¶å]_version_[ç‰ˆæœ¬].pdf`
- ç¤ºä¾‹ï¼š`cll_version_1_2026.pdf`

## âœ… ä¿®å¤ç¡®è®¤

**é—®é¢˜çŠ¶æ€**: âœ… å·²å®Œå…¨è§£å†³
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡
**ç”¨æˆ·è¦æ±‚**: âœ… 100%ç¬¦åˆ

ç°åœ¨çš„æ–‡ä»¶åç”Ÿæˆå®Œå…¨æŒ‰ç…§ç”¨æˆ·è¦æ±‚ï¼š
- ä»PDFé“¾æ¥æå–åŸå§‹æ–‡ä»¶å
- ç»“åˆç‰ˆæœ¬ä¿¡æ¯ç”Ÿæˆæ ¼å¼åŒ–çš„æ–‡ä»¶å
- ä¿æŒç®€æ´æœ‰æ•ˆçš„å‘½åè§„åˆ™